# NETISエージェント 起動方法

## 🚀 クイックスタート

### 1. ターミナルを開く

**macOS:**
- Spotlight検索（Command + Space）で「ターミナル」と入力
- または アプリケーション > ユーティリティ > ターミナル.app

### 2. プロジェクトディレクトリに移動

```bash
cd /Users/keita/Documents/個人開発/netisagent/netisagent
```

### 3. Webアプリを起動

```bash
streamlit run app.py
```

### 4. ブラウザでアクセス

起動後、以下のURLが表示されます：

```
Local URL: http://localhost:8501
```

ブラウザで **http://localhost:8501** を開いてください。

**自動的にブラウザが開かない場合:**
- 上記のURLをコピーしてブラウザのアドレスバーに貼り付け

---

## 📱 使い方

### 検索例

チャット欄に自然な質問を入力：

- 「トンネルの漏水対策技術を教えて」
- 「環境負荷が少ない工法は？」
- 「道路の舗装に使える新技術を探している」

### フォローアップ質問

検索結果が表示されたら：

- 「1番目の技術について詳しく教えて」
- 「もっと絞り込みたい」
- 「1番と3番を比較して」

### サイドバー機能

- **検索結果数調整**: 5〜20件
- **分類フィルタ**: 工事種別で絞り込み
- **会話リセット**: 新しい検索を開始

---

## ⚠️ トラブルシューティング

### アプリが起動しない

**エラー: `streamlit: command not found`**
```bash
# Streamlitを再インストール
pip3 install streamlit
```

**エラー: `ModuleNotFoundError`**
```bash
# 必要なライブラリを再インストール
pip3 install -r requirements.txt
```

### ポート8501が使用中

```bash
# 既存のプロセスを確認
lsof -i :8501

# プロセスを停止（PIDは上記コマンドで確認）
kill -9 <PID>

# または別のポートで起動
streamlit run app.py --server.port 8502
```

### 検索結果が表示されない

**データが投入されているか確認:**
1. Azure Portal (https://portal.azure.com) にログイン
2. Azure AI Search → `agent-ai-searchemm626t4gwnom` を開く
3. インデックス → `netis-index` を選択
4. ドキュメント数が **415件** であることを確認

**データが0件の場合:**
```bash
# データを再投入
python3 upload_to_search.py
```

### Azure接続エラー

**エラー: `Authentication failed`**

`.env`ファイルを確認：
```bash
cat .env
```

以下の情報が正しいか確認：
- `AZURE_SEARCH_ENDPOINT`
- `AZURE_SEARCH_API_KEY`
- `AZURE_OPENAI_ENDPOINT`
- `AZURE_OPENAI_API_KEY`

---

## 🛑 アプリを停止する方法

### ターミナルで停止

ターミナルで **Ctrl + C** を押す

### バックグラウンドで起動している場合

```bash
# プロセスを確認
ps aux | grep streamlit

# プロセスを停止（PIDは上記で確認）
kill -9 <PID>
```

---

## 📦 初回セットアップ（初めて使う場合のみ）

### 1. 必要なライブラリをインストール

```bash
cd /Users/keita/Documents/個人開発/netisagent/netisagent
pip3 install -r requirements.txt
```

### 2. 環境変数を設定

`.env`ファイルが存在するか確認：
```bash
ls -la .env
```

存在しない場合は、`.env.template`をコピー：
```bash
cp .env.template .env
```

### 3. データを投入（初回のみ）

```bash
python3 upload_to_search.py
```

処理時間: 約5〜10分

---

## 💡 ヒント

### バックグラウンドで起動

ターミナルを閉じても動作させたい場合：

```bash
# バックグラウンドで起動
nohup streamlit run app.py --server.headless true > streamlit.log 2>&1 &

# プロセスIDを確認
echo $!

# ログを確認
tail -f streamlit.log
```

### 自動起動（macOS）

毎回手動で起動するのが面倒な場合、Automatorやlaunchdで自動起動設定が可能です。

---

## 📊 システム要件

- Python 3.11以上
- macOS / Linux / Windows
- インターネット接続（Azure API使用）
- 最低8GB RAM推奨

---

## 🔗 関連ドキュメント

- [README.md](README.md) - プロジェクト全体の説明
- [DEVELOPMENT_LOG.md](DEVELOPMENT_LOG.md) - 開発履歴
- [requirements.txt](requirements.txt) - 依存ライブラリ一覧

---

## ❓ よくある質問

**Q: 毎回データ投入が必要ですか？**
A: いいえ、データは Azure AI Search に保存されているため、1度投入すればOKです。

**Q: インターネット接続は必須ですか？**
A: はい、Azure OpenAI と Azure AI Search を使用するため必須です。

**Q: 複数のブラウザで同時にアクセスできますか？**
A: はい、複数ブラウザ・タブで同時アクセス可能です。各セッションは独立しています。

**Q: データを更新したい場合は？**
A: `netisデータ.xlsx`を更新後、`python3 upload_to_search.py`を再実行してください。

---

**更新日: 2025-10-19**
